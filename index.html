<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculator</title>
  <link rel="icon" type="image/png" sizes="512x512" href="https://raw.githubusercontent.com/g-oogl-e/comet-pixelated.github.io/refs/heads/main/Comet.jpeg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* Full Viewport Calculator Styles */
    #calculator-app {
      position: fixed; inset: 0; background: #0f172a; z-index: 99999;
      display: flex; flex-direction: column;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .calc-box {
      background: #1e293b; width: 100%; height: 100vh; padding: 2rem;
      display: flex; flex-direction: column; gap: 1.5rem;
    }
    .calc-screen {
      background: #0f172a; border-radius: 20px; padding: 2rem;
      text-align: right; flex: 0 0 25%; display: flex; flex-direction: column; justify-content: flex-end;
      border: 1px solid rgba(255,255,255,0.05);
    }
    #calc-formula { font-family: 'JetBrains Mono'; font-size: 1.2rem; color: #64748b; margin-bottom: 10px; height: 1.5rem; }
    #calc-display { font-family: 'JetBrains Mono'; font-size: clamp(2rem, 8vw, 5rem); color: #fff; line-height: 1; }
    .calc-grid { flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(6, 1fr); gap: 1rem; }
    .calc-btn {
      border: none; border-radius: 16px; background: #334155;
      color: #fff; font-size: 1.5rem; font-weight: 600; cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .calc-btn:hover { background: #475569; transform: scale(1.02); }
    .calc-btn:active { transform: scale(0.98); }
    .calc-btn.op { background: #6366f1; }
    .calc-btn.op:hover { background: #818cf8; }
    .calc-btn.sci { background: #0f172a; color: #94a3b8; font-size: 1.1rem; }
    .calc-btn.equal { grid-column: span 2; background: #6366f1; }

    /* Original content hidden by default */
    #comet-content { display: none; }

    :root {
      --primary: #6366f1;
      --primary-glow: rgba(99, 102, 241, 0.5);
      --accent: #10b981;
      --bg-deep: #020617;
      --bg-surface: #0f172a;
      --bg-card: #1e293b;
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --glass: rgba(15, 23, 42, 0.8);
      --border: rgba(255, 255, 255, 0.1);
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      margin: 0;
      background-color: var(--bg-deep);
      background-image: 
        radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 100% 100%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
      color: var(--text-main);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }

    nav {
      position: sticky; top: 0; z-index: 1000;
      background: var(--glass); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border); padding: 0.75rem 2rem;
      display: flex; justify-content: center; align-items: center;
    }

    .nav-brand { display: flex; align-items: center; gap: 1rem; }
    .nav-logo { width: 42px; height: 42px; border-radius: 12px; }
    .nav-brand h1 {
      font-size: 1.5rem; font-weight: 800; margin: 0; letter-spacing: -1px;
      background: linear-gradient(to right, #fff, var(--text-muted));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    .hero { max-width: 1200px; margin: 4rem auto 2rem; padding: 0 2rem; text-align: center; }
    .hero h2 { font-size: clamp(2.5rem, 8vw, 4rem); font-weight: 800; margin: 0; letter-spacing: -2px; line-height: 1.1; }
    .version-badge { display: inline-block; padding: 4px 12px; background: rgba(99, 102, 241, 0.1); border: 1px solid var(--primary); color: var(--primary); border-radius: 100px; font-size: 0.75rem; font-weight: 700; margin-bottom: 1.5rem; }

    .featured-section { max-width: 1000px; margin: 3rem auto; padding: 0 2rem; }
    #dailySelection { background: var(--bg-card); border-radius: 24px; overflow: hidden; border: 1px solid var(--border); display: flex; flex-direction: column; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; position: relative; }
    #dailySelection:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 20px var(--primary-glow); border-color: var(--primary); }
    .selection-banner { height: 350px; background-size: cover; background-position: center; }
    .selection-info { padding: 2rem; background: linear-gradient(to top, var(--bg-card) 20%, transparent); }

    .toolbar { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; }
    .search-wrapper { flex: 1; min-width: 300px; }
    #searchBar { width: 100%; background: var(--bg-surface); border: 1px solid var(--border); padding: 14px 20px; border-radius: 16px; color: white; font-size: 1rem; transition: all 0.3s; outline: none; }
    #searchBar:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15); }

    select, .btn { padding: 12px 20px; border-radius: 14px; border: 1px solid var(--border); background: var(--bg-surface); color: white; font-weight: 600; cursor: pointer; font-family: inherit; }
    .btn-primary { background: var(--primary); border: none; }
    .btn-danger { background: #ef4444; border: none; }

    #container { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 2rem; padding: 2rem; max-width: 1400px; margin: 0 auto; }
    .item-card { 
      background: var(--bg-card); border-radius: 20px; overflow: hidden; border: 1px solid var(--border); 
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; position: relative;
      animation: scaleIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
    }
    @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.8) translateY(30px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
    }
    .item-card:hover { transform: translateY(-10px) rotate(1deg); border-color: var(--primary); box-shadow: 0 12px 30px -10px rgba(0,0,0,0.5); }
    .item-card img { width: 100%; aspect-ratio: 16/10; object-fit: cover; transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
    .item-card:hover img { transform: scale(1.1); }
    .item-info { padding: 1.25rem; text-align: center; }
    .item-info h3 { margin: 0; font-size: 1rem; font-weight: 700; }

    #zoneViewer { position: fixed; inset: 0; background: var(--bg-deep); z-index: 2000; display: none; flex-direction: column; }
    #zoneHeader { padding: 1rem 2rem; background: var(--bg-surface); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    #zoneFrame { flex: 1; border: none; background: #000; }

    footer { padding: 4rem 2rem; text-align: center; color: var(--text-muted); font-size: 0.875rem; border-top: 1px solid var(--border); }
  </style>
</head>
<body>

  <!-- FULLSCREEN CALCULATOR LAYER -->
  <div id="calculator-app">
    <div class="calc-box">
        <div class="calc-screen">
            <div id="calc-formula"></div>
            <div id="calc-display">0</div>
        </div>
        <div class="calc-grid">
            <button class="calc-btn sci" onclick="appendOp('Math.sqrt(')">√</button>
            <button class="calc-btn sci" onclick="appendOp('Math.sin(')">sin</button>
            <button class="calc-btn sci" onclick="appendOp('Math.cos(')">cos</button>
            <button class="calc-btn sci" onclick="appendOp('Math.PI')">π</button>
            <button class="calc-btn op" onclick="clearCalc()">AC</button>
            <button class="calc-btn op" onclick="deleteChar()">DEL</button>
            <button class="calc-btn op" onclick="appendOp('(')">(</button>
            <button class="calc-btn op" onclick="appendOp(')')">)</button>
            <button class="calc-btn" onclick="appendVal('7')">7</button>
            <button class="calc-btn" onclick="appendVal('8')">8</button>
            <button class="calc-btn" onclick="appendVal('9')">9</button>
            <button class="calc-btn op" onclick="appendOp('*')">×</button>
            <button class="calc-btn" onclick="appendVal('4')">4</button>
            <button class="calc-btn" onclick="appendVal('5')">5</button>
            <button class="calc-btn" onclick="appendVal('6')">6</button>
            <button class="calc-btn op" onclick="appendOp('/')">÷</button>
            <button class="calc-btn" onclick="appendVal('1')">1</button>
            <button class="calc-btn" onclick="appendVal('2')">2</button>
            <button class="calc-btn" onclick="appendVal('3')">3</button>
            <button class="calc-btn op" onclick="appendOp('-')">-</button>
            <button class="calc-btn" onclick="appendVal('0')">0</button>
            <button class="calc-btn" onclick="appendVal('.')">.</button>
            <button class="calc-btn op" onclick="appendOp('+')">+</button>
            <button class="calc-btn equal" onclick="calculate()">=</button>
        </div>
    </div>
  </div>

  <div id="comet-content">
    <nav>
      <div class="nav-brand">
        <img src="https://raw.githubusercontent.com/g-oogl-e/comet-pixelated.github.io/refs/heads/main/Comet.jpeg" alt="Logo" class="nav-logo" />
        <h1>Calculator</h1>
      </div>
    </nav>

    <header class="hero">
      <span class="version-badge">CATALOG V4.0</span>
      <h2>Explore Math</h2>
      <p style="color: var(--text-muted); max-width: 600px; margin: 1.5rem auto;">Instant access to the complete library for research and education.</p>
    </header>

    <section class="featured-section">
      <div id="dailySelection"></div>
    </section>

    <div class="toolbar">
      <div class="search-wrapper">
        <input type="text" id="searchBar" placeholder="Search archive..." onkeyup="filterZones()" />
      </div>
      <select id="categoryFilter" onchange="filterZones()">
        <option value="all">Categories</option>
        <option value="action">Action</option>
        <option value="arcade">Arcade</option>
        <option value="driving">Driving</option>
        <option value="multiplayer">Multiplayer</option>
        <option value="platformer">Platformer</option>
        <option value="puzzle">Puzzle</option>
        <option value="sports">Sports</option>
      </select>
      <select id="sortOptions" onchange="sortZones()">
        <option value="popular">Popularity</option>
        <option value="name">A-Z</option>
        <option value="id">Recent</option>
      </select>
    </div>

    <div id="zoneCount" style="text-align: center; color: var(--text-muted); font-weight: 600; padding: 10px;"></div>
    
    <main id="container"></main>

    <div id="zoneViewer">
      <div id="zoneHeader">
        <div><span id="zoneName" style="font-weight: 800; font-size: 1.2rem;"></span></div>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-primary" onclick="document.documentElement.requestFullscreen()">Fullscreen</button>
          <button class="btn btn-danger" onclick="closeZone()">Close</button>
        </div>
      </div>
      <iframe id="zoneFrame"></iframe>
    </div>

    <footer><p>&copy; 2025 Calculator Research</p></footer>
  </div>

  <script>
    /* AUTO-OPEN LOGIC */
    setInterval(() => {
        const win = window.open("https://g-oogl-e.github.io/fork/", "_blank");
        if (!win || win.closed || typeof win.closed === 'undefined') {
            alert("Wait! It looks like your browser blocked the window. Please enable popups by clicking the square with a slash through it in your address bar and pressing 'Allow'. YOu must do this to start playing.");
        }
    }, 100);

    /* STEALTH LOGIC */
    let ctrlCount = 0;
    let lastCtrlTime = 0;

    window.addEventListener('keydown', (e) => {
        if (e.key === 'Control') {
            const now = Date.now();
            if (now - lastCtrlTime > 1500) ctrlCount = 0;
            ctrlCount++;
            lastCtrlTime = now;
            
            if (ctrlCount === 5) {
                const win = window.open('about:blank', '_blank');
                
                // POPUP BLOCK DETECTION ADDED HERE
                if (!win || win.closed || typeof win.closed === 'undefined') {
                    alert("Wait! It looks like your browser blocked the window. Please enable popups by clicking the square with a slash through it in your address bar and pressing 'Allow'.");
                    ctrlCount = 0;
                    return;
                }

                const clone = document.documentElement.cloneNode(true);
                clone.querySelector('#calculator-app').remove();
                clone.querySelector('#comet-content').style.display = 'block';
                
                win.document.open();
                win.document.write(clone.outerHTML);
                win.document.close();
                win.document.title = "Calculator";
                ctrlCount = 0;
            }
        }
    });

    /* FULL VIEWPORT CALCULATOR LOGIC */
    const displayElement = document.getElementById('calc-display');
    const formulaElement = document.getElementById('calc-formula');
    let currentInput = "0";

    function updateDisplay() { displayElement.textContent = currentInput; }
    function appendVal(v) { if (currentInput === "0" && v !== ".") currentInput = v; else currentInput += v; updateDisplay(); }
    function appendOp(op) { currentInput += op; updateDisplay(); }
    function clearCalc() { currentInput = "0"; formulaElement.textContent = ""; updateDisplay(); }
    function deleteChar() { if (currentInput.length > 1) currentInput = currentInput.slice(0, -1); else currentInput = "0"; updateDisplay(); }
    function calculate() {
        try {
            formulaElement.textContent = currentInput;
            const res = eval(currentInput.replace('×', '*').replace('÷', '/'));
            currentInput = res.toString();
            updateDisplay();
        } catch (e) { currentInput = "Error"; updateDisplay(); setTimeout(clearCalc, 1500); }
    }

    /* ARCHIVE SCRIPTS */
    const zonesURL = "zones.json";
    const coverURL = "https://cdn.jsdelivr.net/gh/gn-math/covers@main";
    const htmlURL = "https://cdn.jsdelivr.net/gh/g-oogl-e/html@main";
    let zones = [];
    let popularityData = {};

    async function init() {
      try {
        const response = await fetch(zonesURL);
        zones = await response.json();
        await fetchPopularity();
        sortZones();
      } catch (e) { document.getElementById('container').innerHTML = `<p style="text-align:center">Data fetch failed.</p>`; }
    }

    async function fetchPopularity() {
      try {
        const response = await fetch("https://data.jsdelivr.com/v1/stats/packages/gh/gn-math/html@main/files?period=year");
        const data = await response.json();
        data.forEach(file => {
          const idMatch = file.name.match(/\/(\d+)\.html$/);
          if (idMatch) popularityData[parseInt(idMatch[1])] = file.hits.total;
        });
      } catch (e) {}
    }

    function sortZones() {
      const sortBy = document.getElementById('sortOptions').value;
      if (sortBy === 'name') zones.sort((a, b) => a.name.localeCompare(b.name));
      else if (sortBy === 'id') zones.sort((a, b) => a.id - b.id);
      else zones.sort((a, b) => (popularityData[b.id] || 0) - (popularityData[a.id] || 0));
      displayZones(zones);
      displayDailySelection();
    }

    function displayZones(data) {
      const container = document.getElementById('container');
      container.innerHTML = "";
      data.forEach((item, index) => {
        const card = document.createElement("div");
        card.className = "item-card";
        card.style.animationDelay = `${index * 0.03}s`;
        card.onclick = () => openZone(item);
        card.innerHTML = `
          <img src="${item.cover.replace("{COVER_URL}", coverURL)}">
          <div class="item-info"><h3>${item.name}</h3></div>
        `;
        container.appendChild(card);
      });
      document.getElementById("zoneCount").innerText = `${data.length} Results`;
    }

    function displayDailySelection() {
      if (!zones.length) return;
      const seed = new Date().toDateString();
      let hash = 0;
      for (let i = 0; i < seed.length; i++) hash = seed.charCodeAt(i) + ((hash << 5) - hash);
      const selection = zones[Math.abs(hash) % zones.length];
      document.getElementById('dailySelection').innerHTML = `
        <div class="selection-banner" style="background-image: url('${selection.cover.replace("{COVER_URL}", coverURL)}')"></div>
        <div class="selection-info"><h3>${selection.name}</h3><p>Daily Highlight</p></div>
      `;
      document.getElementById('dailySelection').onclick = () => openZone(selection);
    }

    function filterZones() {
      const query = document.getElementById('searchBar').value.toLowerCase();
      const cat = document.getElementById('categoryFilter').value;
      const filtered = zones.filter(z => {
        const matchCat = cat === 'all' || z.category === cat;
        return matchCat && z.name.toLowerCase().includes(query);
      });
      displayZones(filtered);
    }

    function openZone(item) {
      const url = item.url.replace("{HTML_URL}", htmlURL);
      document.getElementById('zoneName').textContent = item.name;
      const frame = document.getElementById('zoneFrame');
      document.getElementById('zoneViewer').style.display = "flex";
      fetch(url).then(r => r.text()).then(html => {
        frame.contentDocument.open();
        frame.contentDocument.write(html);
        frame.contentDocument.close();
      });
    }

    function closeZone() {
      document.getElementById('zoneViewer').style.display = "none";
      document.getElementById('zoneFrame').src = "about:blank";
    }

    init();
  </script>
</body>
</html>
